### Этапы
- [ ] Реализация общего чата
- [ ] Реализация личного чата
### Общий чат
#### Нюансы:
1. Статусы. Создатель, админ, обычный. управлять статусами может только создатель. создатель может исключить всех. Админ - любого обычного участника. Обычный - только кого сам пригласил. Все могут: менять аву, название и добавлять участников.
2. При выходе можно отменить его в течение 5 секунд. При выходе/исключении удаляется вся переписка. Вернуться самому нельзя (вас должны пригласить обратно).
3. После присоединения предыдущие сообщения не видны.
### Личный чат
#### Нюансы:
1. Создается при начале переписки (при отправке первого сообщения)
2. Нельзя ничего менять (аватарку, название, участников)
3. Отсутствуют статусы

----
### Какой функционал должен быть?
- [x] **Получение чата** (шифруется)
- [x] **Получение сообщений чата** (шифруется)
- [x] **Создание чата** (общего)
- [ ] Создание чата (личного)
- [x] **Удаление чата**
- [x] **Приглашение**
- [ ] Исключение
- [x] **Выход**
- [ ] Изменение названия
- [ ] Изменение аватарки
- [ ] Удаление аватарки
- [ ] Повышение/понижение статуса


### Общие проверки:
1. **Авторизован ли пользователь?** (401)
2. **Есть ли ключ сессии?** (401)

### 1. Получение чата (шифруется)
###### GET /chat/:chat_id
- RESPONSE: {chat, unreadCount, lastMessage, avatar} 
- STATUS: 200, 400, 401, 403, 404, 500
###### Проверки:
3. Данные существуют?
4. Есть ли чат?
5. Вы участник?
###### Процесс:
1. Подсчет количества всех сообщений, начиная с даты последнего просмотра
2. Получение последнего сообщения
3. Получение аватарки
### 2. Получение сообщений чата (шифруется)
###### POST /chat/:chat_id/messages
- BODY: {timestamp, newest}
- RESPONSE: {messages}
- STATUS: 200,400,401,403,404,500
###### Проверки:
3. Данные существуют?
4. Есть ли чат?
5. Участник?
###### Процесс:
1. Получение сообщений. Если newest=true, то 10 по времени новее чем указанный timestamp. Иначе старее и включительно
### 3. Создание чата (общего)
###### POST /chat
- BODY: {title}
- STATUS: 201,400,401,500
###### Проверки:
3. Данные?
###### Процесс:
1. Создание записи чата
2. Добавление первого участника - создателя
3. Создание комнаты чата и добавление создателя
###### SERVER: chat (Encrypt) => room(chatID)
- {Chat}
### 4. Создание чата (личного)
-

### 5. Удаление чата
###### GET /chat/:chat_id/remove
- STATUS: 201,400,401,403,404,500
###### Проверки:
3. Данные?
4. Чат есть?
5. Создатель?
###### Процесс:
1. Удаление всех сообщений
   - вложения
	   - из хранилища
	   - запись
   - запись
2. Удаление всех участников
3. Удаление аватарки
   - из хранилища
   - запись
4. Удаление записи чата
5. **SERVER: chat/remove => room(chatID)**
### 6. Приглашение в чат
###### POST /chat/:chat_id/member
- BODY: {userID}
- STATUS: 201,400,401,404,500
###### Проверки:
3. Данные?
4. Чат?
5. Вы участник?
6. Приглашенный существует?
7. Приглашенного еще нет в чате?
###### Процесс:
1. Запись в member: **chatID, userID, invitedAt, lastSeen, invitedBy**
2. Создание системного сообщения о приглашении
**3. SERVER: chat/member => room(chatID)**
   - {message}
### 7. Исключение из чата
###### Проверки:

###### Процесс:
Исключение:
1. REST: chatID, memberID
2. CHECK: Данные существуют; чат существует; memberID существует
3. CHECK: Уровень отправителя больше чем того, кого исключают; либо отправитель пригласил того, кого исключают && их уровень одинаков и равен 3 (обычный)
4. Системное уведомление об исключении
5. Удаление записи member
6. RETURN: системное сообщение

### 8. Выход
###### GET /chat/:chat_id/member/:member_id/leave
- STATUS: 201,400,401,403,404,500
###### Проверки:
3. Данные?
4. Чат?
5. Участник есть вообще такой?
6. Ты и есть этот участник?
###### Процесс:
1. Если выходит создатель, то назначить создателем первого администратора
2. Удаление записи участника
**2. SERVER: chat/member/leave => room(chatID)**
   - {userID}
### 9. Изменение названия
###### POST /chat/:chat_id/title
- BODY: {title}
- STATUS: 201, 400, 401,404,500
###### Проверки:

###### Процесс:
Название:
1. REST: (chatID, title)
2. CHECK: Данные существуют; Чат существует; Отправитель участник чата
3. Изменение в базе названия
4. Добавление системного сообщения в чат об измененном названии
### 10. Изменение аватарки
###### POST /chat/:chat_id/avatar
- FILE
- STATUS: 201,400,401,404,500
###### Проверки:

###### Процесс:
Аватарка:
1. REST: (avatar)
2. CHECK: Данные существуют
3. CHECK: мин. разрешение > 100px; Формат: png | jpg | webp
4. Удаление старой из хранилища
5. Сохранение в хранилище новой (под этим же ID)
### 11. Удаление аватарки
###### GET /chat/:chat_id/avatar/remove
- STATUS: 201,400,401,404,500
###### Проверки:

###### Процесс:
### 12. Повышение/понижение статуса
###### GET /chat/:chat_id/member/:member_id/upgrade
- STATUS: 201,400,401,403,404,500
###### GET /chat/:chat_id/member/:member_id/downgrade
- STATUS: 201,400,401,403,404,500
###### Проверки:

###### Процесс:
Статусы:
1. REST: memberID, toLevel
2. CHECK: Данные существуют; такой участник есть;  toLevel = 2 (админ) || 3 (обычный)
3. CHECK: Можно только создателю (level=1)
4. Изменение записи member
5. Системное сообщение о понижении/повышении


