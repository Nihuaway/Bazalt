### Весь функционал

-   [x] Получение чата (шифруется)
-   [x] Получение сообщений чата (шифруется)
-   [x] Создание чата (общего)
-   [x] Создание чата (личного)
-   [x] Удаление чата
-   [x] Приглашение
-   [x] Исключение
-   [x] Выход
-   [x] Изменение названия
-   [x] Изменение аватарки

### Общие проверки:

1. **Авторизован ли пользователь?** (401)
2. **Есть ли ключ сессии?** (401)

### 1. Получение чата (шифруется)

###### GET /chat/:chat_id

-   RESPONSE: {chat, unreadCount, lastMessage, avatar}
-   STATUS: 200, 400, 401, 403, 404, 500

###### Проверки:

3. Данные существуют?
4. Есть ли чат?
5. Вы участник?

###### Процесс:

1. Подсчет количества всех сообщений, начиная с даты последнего просмотра
2. Получение последнего сообщения
3. Получение аватарки

### 2. Получение сообщений чата (шифруется)

###### POST /chat/:chat_id/messages

-   BODY: {timestamp, newest}
-   RESPONSE: {messages}
-   STATUS: 200,400,401,403,404,500

###### Проверки:

3. Данные существуют?
4. Есть ли чат?
5. Вы участник?

###### Процесс:

1. Получение сообщений. Если newest=true, то 10 по времени новее чем указанный timestamp. Иначе старее и включительно

### 3. Создание чата (общего)

###### POST /chat

-   BODY: {title}
-   STATUS: 201,400,401,500

###### Проверки:

3. Данные существуют?

###### Процесс:

1. Создание записи чата
2. Добавление первого участника - создателя
3. Создание комнаты чата и добавление создателя

###### SERVER: chat (Encrypt) => room(chatID) = {Chat}

### 4. Создание чата (личного)

###### POST /chat/private

-   BODY: {second_user_id}
-   STATUS: 201,400,401,500

###### Проверки:

3. Данные существуют?
4. Второй пользователь существует?

###### Процесс:

1. Создание записи чата
2. Добавление двух участников
3. Создание комнаты чата и добавление участников

### 5. Удаление чата

###### GET /chat/:chat_id/remove

-   STATUS: 201,400,401,403,404,500

###### Проверки:

3. Данные?
4. Чат есть?
5. Чат общий?
6. Вы создатель?

###### Процесс:

1. Удаление всех сообщений
    - запись
2. Удаление всех участников
3. Удаление аватарки
    - из хранилища
    - запись
4. Удаление записи чата
5. **SERVER: chat/remove => room(chatID)**

### 6. Приглашение в чат

###### POST /chat/:chat_id/member

-   BODY: {invitedID}
-   STATUS: 201,400,401,404,500

###### Проверки:

3. Данные?
4. Чат?
5. Чат общий?
6. Вы участник?
7. Приглашенный существует?
8. Приглашенного еще нет в чате?

###### Процесс:

1. Запись в member: **chatID, userID, invitedAt, lastSeen, invitedBy**
2. Создание системного сообщения о приглашении

###### SERVER: chat/member => room(chatID) = {message}

### 7. Исключение из чата

###### POST /chat/:chat_id/member/kick

-   BODY: {to_kick_id}
-   STATUS: 201,400,401,404,500

###### Проверки:

3. Данные есть?
4. Чат есть?
5. Есть ли такой участник?
6. Отправитель - участник чата?
7. Отправитель ли пригласил того, кого надо искл.?

###### Процесс:

1. Системное уведомление об исключении
2. Получение его socketID
3. Удаление записи участника

###### SERVER: chat/member/kick => room(chatID) {userID}

### 8. Выход

###### GET /chat/:chat_id/leave

-   STATUS: 201,400,401,403,404,500

###### Проверки:

3. Данные есть?
4. Чат есть?
5. Есть ли такой участник?

###### Процесс:

1. Если выходит создатель, то назначить создателем первого, кто зашел в чат
2. Удаление записи участника

###### SERVER: chat/member/leave => room(chatID) = {userID}

### 9. Изменение названия

###### POST /chat/:chat_id/edit/title

-   BODY: {title}
-   STATUS: 201, 400, 401,404,500

###### Проверки:

3. Данные есть?
4. Чат есть?
5. Есть ли такой участник?
6. Название соответствует требованиям? (без спец. символов)

###### Процесс:

1. Изменение в базе названия
2. Добавление системного сообщения в чат об измененном названии

###### SERVER: chat/edit/title => room(chatID) = {title}

### 10. Изменение аватарки

###### POST /chat/:chat_id/edit/avatar

-   FILE
-   STATUS: 201,400,401,404,500

###### Проверки:

3. Данные есть?
4. Чат есть?
5. Есть ли такой участник?
6. Аватарка соответствует требованиям?

###### Процесс:

Если аватарка уже есть:

1. изменение файла в хранилище на новый
2. системное сообщение об изм. аватарки
   Если нету:
3. Создание записи аватарки в базе
4. Добавление файла в хранилище
5. системное сообщение об изм. аватарки

###### SERVER: chat/edit/avatar => room(chatID) = {path}
