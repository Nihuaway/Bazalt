## 1. Цель проекта
Цель проекта - разработать мессенджер, научиться применять новые технологии: Redis, Firebase, express-session, socket.io, minIO.
## 2. Описание системы
Система позволяет обмениваться сообщениями (минимальный функционал обычного мессенджера), прикреплять к сообщениям фото/видео. Создавать чаты. В чатах можно менять аватар и название, добавлять/исключать других пользователей, назначать их администраторами. Также сам пользователь может добавить себе аватар.

###### **Система состоит из следующих функциональных блоков:**
1. Регистрация, аутентификация, восстановление пароля (auth)
2. Функционал сообщений (messages)
3. Функционал чатов (chats)
4. Функционал обработчика файлов (фото, видео) (files)
5. Функционал пользователя (user)

#### 2.1 **Регистрация**
После регистрации на указанную почту приходит письмо активации аккаунта. Без активации в аккаунт зайти нельзя.
###### *Обязательные поля:*
- email
- name
- password
#### 2.2 **Аутентификация**
Аутентификация происходит по паролю, указанным пользователем при регистрации.
После входа создается сессия в Redis. Проверка аутентификации проходит так: есть сессия - аутентификация пройдена (Истекшие сессии Redis удаляет сам). 
В сессии храниться id пользователя и ключ этой сессии (он нужен для шифрования сообщений). Ключ генерируется по протоколу Deffie-Hellman после успешной аутентификации. У клиента и сервера ключи должны совпадать.

#### 2.3 **Функционал сообщений**
Пользователь может отправить личное сообщение (напрямую другому пользователю) либо в чат. Для передачи сообщений используется socket.IO
##### *Вложения*
Пользователь может прикрепить к своему сообщению фотку и/или видео. 
##### *Шифрование*
Для шифрования данных используется два ключа (ключи *шифрования* и *верификации*), которые сгенерированы с помощью стандарта PBKDF2 на основе *сессионного* ключа. Данные шифруется ключом *шифрования*, а также создается запись для верификации, созданная на основе зашифрованных данных с помощью хеша (HmacSHA256) и ключа *верификации*.
##### *Дешифрование*
Данные дешифруются с помощью ключа шифрования, далее они хешируется *(с помощью (HmacSHA256) и ключа верификации)* и сверяются с хешем верификации. Если записи совпали, значит сообщение получено без подмен и является настоящим.
#### 2.4 **Функционал чатов**
Пользователи могут создавать чаты, приглашать туда других людей.
В чате есть 3 типа пользователей: Создатель, администратор и обычный пользователь.
###### *Общие возможности:*
- писать сообщения
- изменять аватар и название чата
- приглашение пользователей
###### *Возможности создателя (полные):*
- удаление всех пользователей
- удаление/назначение статуса администратора
###### *Администратор:*
- удаление обычных пользователей
###### *Обычный пользователь (минимальные):*
- удаление **только приглашенных** пользователей


##### **Аватар**
чат может иметь только одну аватарку.

##### **Участники**
*При приглашении они не видят сообщения, написанные до их приглашения.*
Сделать админом участника может только создатель, он же может и убрать этот статус с участника.

При выходе вернуться самостоятельно в чат нельзя, для этого вас должны добавить обратно, причем все сообщения будут стерты. При самовольном выходе будет возможность вернуться в течении 5 секунд.


#### 2.5 **Функционал обработчика файлов (фото, видео)**
Для хранения файлов использовано облачное хранилище MinIO.
Для их получения на сервере - Multer.
Обработка фото будет с помощью sharp, а видео с помощью ___

Аватарки пользователей и чатов будут сохраняться в нескольких разрешениях:
236, 564, 736 , 1024, 1472.
Все остальное только в одном. Оно будет определяться так: 
- Если меньше 1472 - то какое есть, т.е. исходное. Иначе ставиться 1472 (Изображения. определяется по меньшей стороне)
- Если меньше 720p, исходное. Иначе сжимается до 720p (Видео).

## 3. Стеки технологий
- Бэкенд:
  - JS
  - Фреймворк Express.js
  - БД Firebase
  - БД Redis (для сессий)
  - Socket.io
  - MinIO (хранение файлов)
- *Фронтенд: не определено*